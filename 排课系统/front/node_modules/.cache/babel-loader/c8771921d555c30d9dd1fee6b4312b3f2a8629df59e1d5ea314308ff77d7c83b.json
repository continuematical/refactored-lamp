{"ast":null,"code":"import { reduce, get, isEmpty, isFunction } from '@antv/util';\nimport { Util } from '@antv/g2';\nimport { deepAssign, findGeometry } from '../../../utils';\nimport { isLine } from './option';\n/**\n * 获取 view 的 legendItem，供存在不含有 seriesField 的图形使用\n * @param params\n */\nexport function getViewLegendItems(params) {\n  var view = params.view,\n    geometryOption = params.geometryOption,\n    yField = params.yField,\n    legend = params.legend;\n  var userMarker = get(legend, 'marker');\n  var geometry = findGeometry(view, isLine(geometryOption) ? 'line' : 'interval');\n  if (!geometryOption.seriesField) {\n    var legendItemName = get(view, \"options.scales.\" + yField + \".alias\") || yField;\n    // 返回 g2 设置的图例\n    var colorAttribute = geometry.getAttribute('color');\n    var color = view.getTheme().defaultColor;\n    if (colorAttribute) {\n      color = Util.getMappingValue(colorAttribute, legendItemName, get(colorAttribute, ['values', 0], color));\n    }\n    var marker = (isFunction(userMarker) ? userMarker : !isEmpty(userMarker) && deepAssign({}, {\n      style: {\n        stroke: color,\n        fill: color\n      }\n    }, userMarker)) || (isLine(geometryOption) ? {\n      symbol: function (x, y, r) {\n        return [['M', x - r, y], ['L', x + r, y]];\n      },\n      style: {\n        lineWidth: 2,\n        r: 6,\n        stroke: color\n      }\n    } : {\n      symbol: 'square',\n      style: {\n        fill: color\n      }\n    });\n    return [{\n      value: yField,\n      name: legendItemName,\n      marker: marker,\n      isGeometry: true,\n      viewId: view.id\n    }];\n  }\n  var attributes = geometry.getGroupAttributes();\n  return reduce(attributes, function (items, attr) {\n    var attrItems = Util.getLegendItems(view, geometry, attr, view.getTheme(), userMarker);\n    return items.concat(attrItems);\n  }, []);\n}","map":{"version":3,"names":["reduce","get","isEmpty","isFunction","Util","deepAssign","findGeometry","isLine","getViewLegendItems","params","view","geometryOption","yField","legend","userMarker","geometry","seriesField","legendItemName","colorAttribute","getAttribute","color","getTheme","defaultColor","getMappingValue","marker","style","stroke","fill","symbol","x","y","r","lineWidth","value","name","isGeometry","viewId","id","attributes","getGroupAttributes","items","attr","attrItems","getLegendItems","concat"],"sources":["../../../../src/plots/dual-axes/util/legend.ts"],"sourcesContent":["import { reduce, get, isEmpty, isFunction } from '@antv/util';\nimport { View, Util } from '@antv/g2';\nimport { deepAssign, findGeometry } from '../../../utils';\nimport { GeometryOption } from '../types';\nimport { Legend } from '../../../types/legend';\nimport { isLine } from './option';\n\n/**\n * 获取 view 的 legendItem，供存在不含有 seriesField 的图形使用\n * @param params\n */\nexport function getViewLegendItems(params: {\n  view: View;\n  yField: string;\n  geometryOption: GeometryOption;\n  legend: Legend;\n}) {\n  const { view, geometryOption, yField, legend } = params;\n  const userMarker = get(legend, 'marker');\n\n  const geometry = findGeometry(view, isLine(geometryOption) ? 'line' : 'interval');\n  if (!geometryOption.seriesField) {\n    const legendItemName = get(view, `options.scales.${yField}.alias`) || yField;\n    // 返回 g2 设置的图例\n    const colorAttribute = geometry.getAttribute('color');\n    let color = view.getTheme().defaultColor;\n    if (colorAttribute) {\n      color = Util.getMappingValue(colorAttribute, legendItemName, get(colorAttribute, ['values', 0], color));\n    }\n\n    const marker =\n      (isFunction(userMarker)\n        ? userMarker\n        : !isEmpty(userMarker) &&\n          deepAssign(\n            {},\n            {\n              style: {\n                stroke: color,\n                fill: color,\n              },\n            },\n            userMarker\n          )) ||\n      (isLine(geometryOption)\n        ? {\n            symbol: (x: number, y: number, r: number) => {\n              return [\n                ['M', x - r, y],\n                ['L', x + r, y],\n              ];\n            },\n            style: {\n              lineWidth: 2,\n              r: 6,\n              stroke: color,\n            },\n          }\n        : {\n            symbol: 'square',\n            style: {\n              fill: color,\n            },\n          });\n    return [\n      {\n        value: yField,\n        name: legendItemName,\n        marker,\n        isGeometry: true,\n        viewId: view.id,\n      },\n    ];\n  }\n\n  const attributes = geometry.getGroupAttributes();\n  return reduce(\n    attributes,\n    (items, attr) => {\n      const attrItems = Util.getLegendItems(view, geometry, attr, view.getTheme(), userMarker);\n      return items.concat(attrItems);\n    },\n    []\n  );\n}\n"],"mappings":"AAAA,SAASA,MAAM,EAAEC,GAAG,EAAEC,OAAO,EAAEC,UAAU,QAAQ,YAAY;AAC7D,SAAeC,IAAI,QAAQ,UAAU;AACrC,SAASC,UAAU,EAAEC,YAAY,QAAQ,gBAAgB;AAGzD,SAASC,MAAM,QAAQ,UAAU;AAEjC;;;;AAIA,OAAM,SAAUC,kBAAkBA,CAACC,MAKlC;EACS,IAAAC,IAAI,GAAqCD,MAAM,CAAAC,IAA3C;IAAEC,cAAc,GAAqBF,MAAM,CAAAE,cAA3B;IAAEC,MAAM,GAAaH,MAAM,CAAAG,MAAnB;IAAEC,MAAM,GAAKJ,MAAM,CAAAI,MAAX;EAC5C,IAAMC,UAAU,GAAGb,GAAG,CAACY,MAAM,EAAE,QAAQ,CAAC;EAExC,IAAME,QAAQ,GAAGT,YAAY,CAACI,IAAI,EAAEH,MAAM,CAACI,cAAc,CAAC,GAAG,MAAM,GAAG,UAAU,CAAC;EACjF,IAAI,CAACA,cAAc,CAACK,WAAW,EAAE;IAC/B,IAAMC,cAAc,GAAGhB,GAAG,CAACS,IAAI,EAAE,oBAAkBE,MAAM,WAAQ,CAAC,IAAIA,MAAM;IAC5E;IACA,IAAMM,cAAc,GAAGH,QAAQ,CAACI,YAAY,CAAC,OAAO,CAAC;IACrD,IAAIC,KAAK,GAAGV,IAAI,CAACW,QAAQ,EAAE,CAACC,YAAY;IACxC,IAAIJ,cAAc,EAAE;MAClBE,KAAK,GAAGhB,IAAI,CAACmB,eAAe,CAACL,cAAc,EAAED,cAAc,EAAEhB,GAAG,CAACiB,cAAc,EAAE,CAAC,QAAQ,EAAE,CAAC,CAAC,EAAEE,KAAK,CAAC,CAAC;;IAGzG,IAAMI,MAAM,GACV,CAACrB,UAAU,CAACW,UAAU,CAAC,GACnBA,UAAU,GACV,CAACZ,OAAO,CAACY,UAAU,CAAC,IACpBT,UAAU,CACR,EAAE,EACF;MACEoB,KAAK,EAAE;QACLC,MAAM,EAAEN,KAAK;QACbO,IAAI,EAAEP;;KAET,EACDN,UAAU,CACX,MACJP,MAAM,CAACI,cAAc,CAAC,GACnB;MACEiB,MAAM,EAAE,SAAAA,CAACC,CAAS,EAAEC,CAAS,EAAEC,CAAS;QACtC,OAAO,CACL,CAAC,GAAG,EAAEF,CAAC,GAAGE,CAAC,EAAED,CAAC,CAAC,EACf,CAAC,GAAG,EAAED,CAAC,GAAGE,CAAC,EAAED,CAAC,CAAC,CAChB;MACH,CAAC;MACDL,KAAK,EAAE;QACLO,SAAS,EAAE,CAAC;QACZD,CAAC,EAAE,CAAC;QACJL,MAAM,EAAEN;;KAEX,GACD;MACEQ,MAAM,EAAE,QAAQ;MAChBH,KAAK,EAAE;QACLE,IAAI,EAAEP;;KAET,CAAC;IACR,OAAO,CACL;MACEa,KAAK,EAAErB,MAAM;MACbsB,IAAI,EAAEjB,cAAc;MACpBO,MAAM,EAAAA,MAAA;MACNW,UAAU,EAAE,IAAI;MAChBC,MAAM,EAAE1B,IAAI,CAAC2B;KACd,CACF;;EAGH,IAAMC,UAAU,GAAGvB,QAAQ,CAACwB,kBAAkB,EAAE;EAChD,OAAOvC,MAAM,CACXsC,UAAU,EACV,UAACE,KAAK,EAAEC,IAAI;IACV,IAAMC,SAAS,GAAGtC,IAAI,CAACuC,cAAc,CAACjC,IAAI,EAAEK,QAAQ,EAAE0B,IAAI,EAAE/B,IAAI,CAACW,QAAQ,EAAE,EAAEP,UAAU,CAAC;IACxF,OAAO0B,KAAK,CAACI,MAAM,CAACF,SAAS,CAAC;EAChC,CAAC,EACD,EAAE,CACH;AACH","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}