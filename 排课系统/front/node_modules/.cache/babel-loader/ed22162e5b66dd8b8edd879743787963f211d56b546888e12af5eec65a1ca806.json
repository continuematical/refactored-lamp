{"ast":null,"code":"import { __assign, __spreadArrays } from \"tslib\";\nimport { each } from '@antv/util';\nimport { interaction, theme, state } from '../../adaptor/common';\nimport { flow, pick } from '../../utils';\nimport { polygon, edge } from '../../adaptor/geometries';\nimport { chordLayout } from '../../utils/transform/chord';\nimport { getAllGeometriesRecursively, transformDataToNodeLinkData } from '../../utils';\nimport { X_FIELD, Y_FIELD, NODE_COLOR_FIELD, EDGE_COLOR_FIELD } from './constant';\nfunction transformData(params) {\n  // 将弦图数据放到ext中，nodeGeometry edgeGeometry使用\n  var options = params.options;\n  var data = options.data,\n    sourceField = options.sourceField,\n    targetField = options.targetField,\n    weightField = options.weightField,\n    nodePaddingRatio = options.nodePaddingRatio,\n    nodeWidthRatio = options.nodeWidthRatio,\n    _a = options.rawFields,\n    rawFields = _a === void 0 ? [] : _a;\n  // 将数据转换为node link格式\n  var chordLayoutInputData = transformDataToNodeLinkData(data, sourceField, targetField, weightField);\n  var _b = chordLayout({\n      weight: true,\n      nodePaddingRatio: nodePaddingRatio,\n      nodeWidthRatio: nodeWidthRatio\n    }, chordLayoutInputData),\n    nodes = _b.nodes,\n    links = _b.links;\n  // 1. 生成绘制node使用数据\n  var nodesData = nodes.map(function (node) {\n    return __assign(__assign({}, pick(node, __spreadArrays(['id', 'x', 'y', 'name'], rawFields))), {\n      isNode: true\n    });\n  });\n  // 2. 生成 edge 使用数据 （同桑基图）\n  var edgesData = links.map(function (link) {\n    return __assign(__assign({\n      source: link.source.name,\n      target: link.target.name,\n      name: link.source.name || link.target.name\n    }, pick(link, __spreadArrays(['x', 'y', 'value'], rawFields))), {\n      isNode: false\n    });\n  });\n  return __assign(__assign({}, params), {\n    ext: __assign(__assign({}, params.ext), {\n      // 将chordData放到ext中，方便下面的geometry使用\n      chordData: {\n        nodesData: nodesData,\n        edgesData: edgesData\n      }\n    })\n  });\n}\n/**\n * scale配置\n * @param params 参数\n */\nfunction scale(params) {\n  var _a;\n  var chart = params.chart;\n  chart.scale((_a = {\n    x: {\n      sync: true,\n      nice: true\n    },\n    y: {\n      sync: true,\n      nice: true,\n      max: 1\n    }\n  }, _a[NODE_COLOR_FIELD] = {\n    sync: 'color'\n  }, _a[EDGE_COLOR_FIELD] = {\n    sync: 'color'\n  }, _a));\n  return params;\n}\n/**\n * axis配置\n * @param params 参数\n */\nfunction axis(params) {\n  var chart = params.chart;\n  chart.axis(false);\n  return params;\n}\n/**\n * legend配置\n * @param params 参数\n */\nfunction legend(params) {\n  var chart = params.chart;\n  chart.legend(false);\n  return params;\n}\n/**\n * tooltip配置\n * @param params 参数\n */\nfunction tooltip(params) {\n  var chart = params.chart,\n    options = params.options;\n  var tooltip = options.tooltip;\n  chart.tooltip(tooltip);\n  return params;\n}\n/**\n * coordinate配置\n * @param params 参数\n */\nfunction coordinate(params) {\n  var chart = params.chart;\n  chart.coordinate('polar').reflect('y');\n  return params;\n}\n/**\n * nodeGeometry配置\n * @param params 参数\n */\nfunction nodeGeometry(params) {\n  // node view\n  var chart = params.chart,\n    options = params.options;\n  var nodesData = params.ext.chordData.nodesData;\n  var nodeStyle = options.nodeStyle,\n    label = options.label,\n    tooltip = options.tooltip;\n  var nodeView = chart.createView();\n  nodeView.data(nodesData);\n  // 面\n  polygon({\n    chart: nodeView,\n    options: {\n      xField: X_FIELD,\n      yField: Y_FIELD,\n      seriesField: NODE_COLOR_FIELD,\n      polygon: {\n        style: nodeStyle\n      },\n      label: label,\n      tooltip: tooltip\n    }\n  });\n  return params;\n}\n/**\n * edgeGeometry配置\n * @param params 参数\n */\nfunction edgeGeometry(params) {\n  var chart = params.chart,\n    options = params.options;\n  var edgesData = params.ext.chordData.edgesData;\n  var edgeStyle = options.edgeStyle,\n    tooltip = options.tooltip;\n  var edgeView = chart.createView();\n  edgeView.data(edgesData);\n  // edge\n  var edgeOptions = {\n    xField: X_FIELD,\n    yField: Y_FIELD,\n    seriesField: EDGE_COLOR_FIELD,\n    edge: {\n      style: edgeStyle,\n      shape: 'arc'\n    },\n    tooltip: tooltip\n  };\n  edge({\n    chart: edgeView,\n    options: edgeOptions\n  });\n  return params;\n}\nfunction animation(params) {\n  var chart = params.chart,\n    options = params.options;\n  var animation = options.animation;\n  // 同时设置整个 view 动画选项\n  if (typeof animation === 'boolean') {\n    chart.animate(animation);\n  } else {\n    chart.animate(true);\n  }\n  // 所有的 Geometry 都使用同一动画（各个图形如有区别，自行覆盖）\n  each(getAllGeometriesRecursively(chart), function (g) {\n    g.animate(animation);\n  });\n  return params;\n}\n/**\n * 弦图适配器\n * @param chart\n * @param options\n */\nexport function adaptor(params) {\n  // flow 的方式处理所有的配置到 G2 API\n  return flow(theme, transformData, coordinate, scale, axis, legend, tooltip, edgeGeometry, nodeGeometry, interaction, state, animation)(params);\n}","map":{"version":3,"names":["each","interaction","theme","state","flow","pick","polygon","edge","chordLayout","getAllGeometriesRecursively","transformDataToNodeLinkData","X_FIELD","Y_FIELD","NODE_COLOR_FIELD","EDGE_COLOR_FIELD","transformData","params","options","data","sourceField","targetField","weightField","nodePaddingRatio","nodeWidthRatio","_a","rawFields","chordLayoutInputData","_b","weight","nodes","links","nodesData","map","node","__assign","__spreadArrays","isNode","edgesData","link","source","name","target","ext","chordData","scale","chart","x","sync","nice","y","max","axis","legend","tooltip","coordinate","reflect","nodeGeometry","nodeStyle","label","nodeView","createView","xField","yField","seriesField","style","edgeGeometry","edgeStyle","edgeView","edgeOptions","shape","animation","animate","g","adaptor"],"sources":["../../../src/plots/chord/adaptor.ts"],"sourcesContent":["import { Geometry } from '@antv/g2';\nimport { each } from '@antv/util';\nimport { interaction, theme, state } from '../../adaptor/common';\nimport { Params } from '../../core/adaptor';\nimport { flow, pick } from '../../utils';\nimport { polygon, edge } from '../../adaptor/geometries';\nimport { chordLayout } from '../../utils/transform/chord';\nimport { getAllGeometriesRecursively, transformDataToNodeLinkData } from '../../utils';\nimport { ChordOptions } from './types';\nimport { X_FIELD, Y_FIELD, NODE_COLOR_FIELD, EDGE_COLOR_FIELD } from './constant';\n\nfunction transformData(params: Params<ChordOptions>): Params<ChordOptions> {\n  // 将弦图数据放到ext中，nodeGeometry edgeGeometry使用\n\n  const { options } = params;\n  const { data, sourceField, targetField, weightField, nodePaddingRatio, nodeWidthRatio, rawFields = [] } = options;\n\n  // 将数据转换为node link格式\n  const chordLayoutInputData = transformDataToNodeLinkData(data, sourceField, targetField, weightField);\n\n  const { nodes, links } = chordLayout({ weight: true, nodePaddingRatio, nodeWidthRatio }, chordLayoutInputData);\n\n  // 1. 生成绘制node使用数据\n  const nodesData = nodes.map((node) => {\n    return {\n      ...pick(node, ['id', 'x', 'y', 'name', ...rawFields]),\n      isNode: true,\n    };\n  });\n\n  // 2. 生成 edge 使用数据 （同桑基图）\n  const edgesData = links.map((link) => {\n    return {\n      source: link.source.name,\n      target: link.target.name,\n      name: link.source.name || link.target.name,\n      ...pick(link, ['x', 'y', 'value', ...rawFields]),\n      isNode: false,\n    };\n  });\n\n  return {\n    ...params,\n    ext: {\n      ...params.ext,\n      // 将chordData放到ext中，方便下面的geometry使用\n      chordData: { nodesData, edgesData },\n    },\n  };\n}\n\n/**\n * scale配置\n * @param params 参数\n */\nfunction scale(params: Params<ChordOptions>): Params<ChordOptions> {\n  const { chart } = params;\n  chart.scale({\n    x: { sync: true, nice: true },\n    y: { sync: true, nice: true, max: 1 },\n    [NODE_COLOR_FIELD]: { sync: 'color' },\n    [EDGE_COLOR_FIELD]: { sync: 'color' },\n  });\n  return params;\n}\n\n/**\n * axis配置\n * @param params 参数\n */\nfunction axis(params: Params<ChordOptions>): Params<ChordOptions> {\n  const { chart } = params;\n  chart.axis(false);\n  return params;\n}\n\n/**\n * legend配置\n * @param params 参数\n */\nfunction legend(params: Params<ChordOptions>): Params<ChordOptions> {\n  const { chart } = params;\n  chart.legend(false);\n  return params;\n}\n\n/**\n * tooltip配置\n * @param params 参数\n */\nfunction tooltip(params: Params<ChordOptions>): Params<ChordOptions> {\n  const { chart, options } = params;\n  const { tooltip } = options;\n\n  chart.tooltip(tooltip);\n  return params;\n}\n\n/**\n * coordinate配置\n * @param params 参数\n */\nfunction coordinate(params: Params<ChordOptions>): Params<ChordOptions> {\n  const { chart } = params;\n  chart.coordinate('polar').reflect('y');\n  return params;\n}\n\n/**\n * nodeGeometry配置\n * @param params 参数\n */\nfunction nodeGeometry(params: Params<ChordOptions>): Params<ChordOptions> {\n  // node view\n  const { chart, options } = params;\n  const { nodesData } = params.ext.chordData;\n  const { nodeStyle, label, tooltip } = options;\n\n  const nodeView = chart.createView();\n  nodeView.data(nodesData);\n\n  // 面\n  polygon({\n    chart: nodeView,\n    options: {\n      xField: X_FIELD,\n      yField: Y_FIELD,\n      seriesField: NODE_COLOR_FIELD,\n      polygon: {\n        style: nodeStyle,\n      },\n      label,\n      tooltip,\n    },\n  });\n  return params;\n}\n\n/**\n * edgeGeometry配置\n * @param params 参数\n */\nfunction edgeGeometry(params: Params<ChordOptions>): Params<ChordOptions> {\n  const { chart, options } = params;\n  const { edgesData } = params.ext.chordData;\n  const { edgeStyle, tooltip } = options;\n\n  const edgeView = chart.createView();\n  edgeView.data(edgesData);\n\n  // edge\n  const edgeOptions = {\n    xField: X_FIELD,\n    yField: Y_FIELD,\n    seriesField: EDGE_COLOR_FIELD,\n    edge: {\n      style: edgeStyle,\n      shape: 'arc',\n    },\n    tooltip,\n  };\n  edge({\n    chart: edgeView,\n    options: edgeOptions,\n  });\n  return params;\n}\n\nfunction animation(params: Params<ChordOptions>): Params<ChordOptions> {\n  const { chart, options } = params;\n  const { animation } = options;\n\n  // 同时设置整个 view 动画选项\n  if (typeof animation === 'boolean') {\n    chart.animate(animation);\n  } else {\n    chart.animate(true);\n  }\n\n  // 所有的 Geometry 都使用同一动画（各个图形如有区别，自行覆盖）\n  each(getAllGeometriesRecursively(chart), (g: Geometry) => {\n    g.animate(animation);\n  });\n\n  return params;\n}\n\n/**\n * 弦图适配器\n * @param chart\n * @param options\n */\nexport function adaptor(params: Params<ChordOptions>) {\n  // flow 的方式处理所有的配置到 G2 API\n  return flow(\n    theme,\n    transformData,\n    coordinate,\n    scale,\n    axis,\n    legend,\n    tooltip,\n    edgeGeometry,\n    nodeGeometry,\n    interaction,\n    state,\n    animation\n  )(params);\n}\n"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}